# Cite this work
If you use this code, please cite the following paper:
```
@article {Raabe2025.02.25.25322779,
	author = {Raabe, Florian J. and Popovic, David and Vetter, Clara and Hasanaj, Genc and Karsl{\i}, Berkhan and Fischer, Laura E. and Boudriot, Emanuel and Almeida, Valeria and Atella, Allesia and Sch{\"a}fer, Tim J. and Gagliardi, Miriam and Trastulla, Lucia and Yakimov, Vladislav and Roell, Lukas and Moussiopoulou, Joanna and Kr{\v c}m{\'a}{\v r}, Lenka and Galinski, Sabrina and Papazova, Irina and CDP Working Group and Pogarell, Oliver and Hasan, Alkomiet and Schulte, Eva C. and Schmitt, Andrea and Wagner, Elias and Levina, Anna and Rossner, Moritz J. and Koutsouleris, Nikolaos and Papiol, Sergi and Falkai, Peter and Keeser, Daniel and Ziller, Michael J.},
	title = {Bridging the scales: leveraging personalized disease models and deep phenotyping to dissect cognitive impairment in schizophrenia},
	elocation-id = {2025.02.25.25322779},
	year = {2025},
	doi = {10.1101/2025.02.25.25322779},
	publisher = {Cold Spring Harbor Laboratory Press},
	abstract = {Schizophrenia (SCZ) is a highly heritable brain disorder marked by a wide range of changes throughout the central nervous system. These changes include alterations at the molecular and cellular levels, suggesting significant disruptions in synapse function, as well as modifications in brain structure and activity. However, it remains unclear, how changes in molecular synapse biology translate into neurophysiological and ultimately behavioral consequences across scales. Here, we narrow this translational gap in contemporary biological psychiatry by establishing a generalizable framework to bridge the scales and pinpoint biological mechanisms underlying individual psychiatric symptoms. We show that genetically driven changes in neuronal gene expression and a resulting reduction in excitatory synaptic density in vitro are linked to alterations of brain structure, electrophysiology and ultimately cognitive function in vivo.These results provide a direct connection between the molecular origins of synapse reduction in SCZ and its neurobiological and phenotypic consequences on the individual patient level, paving the way to develop new mechanism informed treatment options.Competing Interest StatementThe authors declare that there are no conflicts of interest in relation to the subject of this study. General declaration of potential conflict of interests: SG is part-time employees by and shareholders of Systasy Bioscience GmbH, Munich, Germany. MJR is shareholder and consultant of Systasy Bioscence GmbH. AH received speaker fees from AbbVie, Advanz, Janssen, Otsuka, Lundbeck, Rovi, and Recordati and was a member of the advisory boards of these companies and Boehringer Ingelheim. BS and MZ received speaker fees from Novartis Pharma GmbH. EW was a member of the advisory boards of Boehringer Ingelheim and Recordati. OP received speaker fees from Lundbeck, Otsuka, Takeda, and Janssen and was a member of the advisory boards of Lundbeck and Janssen. PF received speaker fees from Boehringer Ingelheim, Janssen, Otsuka, Lundbeck, Recordati, and Richter and was a member of the advisory boards of these companies and Rovi.Funding StatementThis work was supported by BMBF, eMed grant numbers 01ZX1504, 01ZX1706A (MJZ), Else-Kroener-Fresenius Stiftung grant A54 (MJZ), DFG Grants GZ: ZI 1614/5-1,ZI 1614/7-1 (MJZ). EB received funding from the Pesl-Alzheimer-Stiftung (2024-2025). DP and FJR were supported by the Else Kroener-Fresenius Foundation (Research College Translational Psychiatry) for their Residency/Ph.D. track at the International Max Planck Research School for Translational Psychiatry (IMPRS-TP), Munich, Germany. FJR and ECS were supported by the Munich Clinician Scientist Program (MCSP) of the Faculty of Medicine, LMU Munich, Munich, Germany (FoeFoLe 009/2019 and Advanced Track 01/2021, respectively). FJR received funding from the Lisa Oehler-Stiftung (2022-2024), the Pesl-Alzheimer-Stiftung (2024-2025). VY was supported by the Residency/PhD track of the International Max Planck Research School for Translational Psychiatry (IMPRS-TP) and was supported by the Faculty of Medicine at LMU Munich (FoeFoLe Reg.-Nr. 1226/2024). JM was supported by the Faculty of Medicine at LMU Munich (FoeFoLe Reg.-Nr. 1167). The study was supported by the EU HORIZON-INFRA-2024-TECH-01-04 project DTRIP4H 101188432 to PF, AS and FR. PF, AS, GH and VY received funding from the BMBF within the Era-Net Neuron project GDNF UpReg (FKZ 01EW2206). The study was endorsed by the Federal Ministry of Education and Research (Bundesministerium fuer Bildung und Forschung [BMBF]) within the initial phase of the German Center for Mental Health (DZPG) (grant: 01EE2303C to AH, and 01EE2303A, 01EE2303F to PF).The study was supported by the Supplement to BMBF funding for the German Centre for Mental Health (DZPG) by the Bavarian State Ministry for Science and the Arts with the Grant for the research project Improving Infrastructures for DZPG and NAKO Cohorts to PF, DK and BK. TS received funding through the Else Kroener Medical Scientist Kolleg ClinbrAIn: Artificial Intelligence for Clinical Brain Research and is supported by the International Max Planck Research School for Intelligent Systems (IMPRS-IS). AL is a member of the Machine Learning Cluster of Excellence, EXC number 2064/1 - project number 39072764.Author DeclarationsI confirm all relevant ethical guidelines have been followed, and any necessary IRB and/or ethics committee approvals have been obtained.YesThe details of the IRB/oversight body that provided approval or exemption for the research described are given below:Ethics committee of the Faculty of Medicine, LMU Munich, Project 17-880, 29.03.2018; project 18-716, 15.10.2020) and at the MPI for Psychiatry (approved by the local ethics committee of the Faculty of Medicine, LMU Munich, project numbers 350-14, 19-310, 20-314,19-678 and 18-393I confirm that all necessary patient/participant consent has been obtained and the appropriate institutional forms have been archived, and that any patient/participant/sample identifiers included were not known to anyone (e.g., hospital staff, patients or participants themselves) outside the research group so cannot be used to identify individuals.YesI understand that all clinical trials and any other prospective interventional studies must be registered with an ICMJE-approved registry, such as ClinicalTrials.gov. I confirm that any such study reported in the manuscript has been registered and the trial registration ID is provided (note: if posting a prospective study registered retrospectively, please provide a statement in the trial ID field explaining why the study was not registered in advance).YesI have followed all appropriate research reporting guidelines, such as any relevant EQUATOR Network research reporting checklist(s) and other pertinent material, if applicable.YesAll data is available in the supplementary data or upon reasonable request to the authors.},
	URL = {https://www.medrxiv.org/content/early/2025/02/27/2025.02.25.25322779},
	eprint = {https://www.medrxiv.org/content/early/2025/02/27/2025.02.25.25322779.full.pdf},
	journal = {medRxiv}
}
```

# Model choice
There is 6 models available for modulating the baseline canonical microcircuit model.
- model 6 (`'all-excitatory'`) modulates all excitatory projections -> this is what we use 
- model 1-5 are from Adams et al. (2022) modulating specific connections

# Pipeline
1. Put your raw data in `data/`. The data should be a csv file containing at least the following columns:
   - subject identifier (`id` or `gId` or something you define)
   - synaptic density value (`Neurite_Syn1Count` or `synDensity` or something you define)
2. `010_create_lookup_table.m` - run different models and create lookup tables.
3. `011_predict_data.py` - predict the relative power from the subject-specific synaptic density data (previously put in `data/`).
4. `012_plot_model.py` (optional) - plot the model prediction of power spectral density for a range of synaptic densities.
5. `013_plot_subjects.py` (optional) - plot the subject-specific power spectral density predictions.

# Folder structure
### data/
Contains your raw data with subjects and their synaptic densities.

### src/
Contains the models and helper functions. Key modules:
- `my_spm_fx_cmc_2017.m` - the main model coded by us
- `modify_cmc_2017.m` - helper function to modify the synaptic gain in the model
- `spm_fx_cmc_2017_constG.m` - code from Adams et al. 2022

### exp/
Contains the scripts described below.

### results/
empty folder where the results will be saved.

### plots/
folder for saving the plots

# Scripts

### 010_create_lookup_table.m
This script generates a lookup table for a range of synaptic densities to later faster predict subject-specific model predictions t

### 011_predict_data.py
Computes a model prediction for each subject using the lookup table and subject-specific synaptic densities.

### 012_plot_model.py
Plots the spectral density prediction of the model for a range of synaptic densities.

### 013_plot_subjects.py
Plots the spectral density prediction of the model for the subject-specific synaptic densities.


### 101_test_my_spm_fx_cmc_2017.m
Test script for model. Run this to confirm it is working as intended.

### 102_test_my_spm_fx_cmc_2017_modularized.m
Tests the functionality of the synaptic gain modification.
Plots the results.

### 103_test_Adams_model.m
Test script for Rick Adams' model.

# Old Pipeline
works only for model `'all-excitatory'`
1. `206_plot_model.m` - run the model for different synaptic gain values and create lookup tables.
2. compute absolute and relative power (script based on which dataset is used):
   - `208_abs_rel_power_data.py`
   - `209_abs_rel_power_data.py`

## Old scripts

### 204_synaptic_modulation.m
Load synaptic density data and run the model.

### 205_compare_EEG.py
Plot model results (from `204_synaptic_modulation.m`) vs rsEEG data.

### 206_plot_model.m
-- old pipeline --\
Run the model (`model='all-excitatory'`) for different synaptic gain values and create lookup table.\
Plot and save the results.

### 207_plot_synGain_vs_relPower.py
-- outdated -- (fix reference to `model_simulation.txt`)\
- Maps measured synaptic density to normalized range.
- plot change in power depending on synaptic gain: model and measured data

### 208_abs_rel_power_data.py
-- old pipeline --\
Compute absolute and relative power from model table (from `206_plot_model.m`).
Save into file.\
Based on data files:
- `EEG_SynDens_v2_power_Measured_synDens_PSD95.txt`
- `EEG_SynDens_v2_power_Measured_synDens_PSD95.txt`
- `EEG_SynDens_v2_power_Predicted_synDens_PSD95.txt`
- `EEG_SynDens_v2_power_Predicted_synDens_SYN1_shank3.txt`

### 209_abs_rel_power_data.py
-- old pipeline --\
Same but based on data files:
- `Measured_Density_reprocessed.txt`
- `Predicted_Density_reprocessed.txt`


# Issue with spm
The default behaviour in spm for `N.nodelay` is inconsistent between versions.
It changed in commit https://github.com/spm/spm/commit/30b2259b1223d7bce7906d484a3d69e8922618ac (spm_dcm_delay.m, line 112).
In previous versions (including the one Adams et al., 2022, is based on) the default was `N.nodelay = 0;`.
In the latest spm version the default is `N.nodelay = 1;`.
We set explicitly `N.nodelay = 0;` to get the old behaviour.

# Acknowledgements
This work is inspired by Adams et al. (2022), for which we created an independent version generating the same results.
We thank Rick Adams for sharing the DCM code and helpful discussions.

# References
Adams, R.A., et al. Computational Modeling of Electroencephalography and Functional Magnetic Resonance Imaging Paradigms Indicates a Consistent Loss of Pyramidal Cell Synaptic Gain in Schizophrenia. Biol Psychiatry 91, 202-215 (2022).
